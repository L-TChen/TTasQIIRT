-- Methods of SC+U+Pi+Id/QIIT
open import Prelude

module SC+U+Pi+Id.QIIT.Elimination.Method where

open import SC+U+Pi+Id.QIIT.Syntax
open import SC+U+Pi+Id.QIIT.Properties
open import SC+U+Pi+Id.QIIT.Elimination.Motive

module _ {â„“ â„“â€²}(Mot : Motive â„“ â„“â€²) where
  open Motive Mot
  private variable
    Î“á´¹ Î”á´¹ Î˜á´¹ Î¦á´¹ : Ctxá´¹ Î“
    Ïƒá´¹ Ï„á´¹ Î³á´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ
    Aá´¹ Bá´¹ Cá´¹ : Tyá´¹ Î“á´¹ i A
    aá´¹ tá´¹ uá´¹ : Tmá´¹ Î“á´¹ Aá´¹ t
    p : Tm Î“ (Id a t u)

  record CwFâ‚ : Set (â„“ âŠ” â„“â€²) where
    field
      [_]á´¹_
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(Aá´¹ : Tyá´¹ Î”á´¹ i A)
        â†’ Tyá´¹ Î“á´¹ i ([ Ïƒ ] A)
      âˆ…á¶œá´¹
        : Ctxá´¹ âˆ…
      _,á¶œá´¹_
        : (Î“á´¹ : Ctxá´¹ Î“)(Aá´¹ : Tyá´¹ Î“á´¹ i A)
        â†’ Ctxá´¹ (Î“ , A)
      âˆ…Ë¢á´¹
        : Subá´¹ Î”á´¹ âˆ…á¶œá´¹ âˆ…
      _,Ë¢á´¹_
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(tá´¹ : Tmá´¹ Î“á´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹) t)
        â†’ Subá´¹ Î“á´¹ (Î”á´¹ ,á¶œá´¹ Aá´¹) (Ïƒ , t)
      idSá´¹
        : Subá´¹ Î“á´¹ Î“á´¹ idS
      _â¨Ÿá´¹_
        : (Ï„á´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ï„)(Ïƒá´¹ : Subá´¹ Î”á´¹ Î˜á´¹ Ïƒ)
        â†’ Subá´¹ Î“á´¹ Î˜á´¹ (Ï„ â¨Ÿ Ïƒ)
      Ï€â‚á´¹
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ (Î”á´¹ ,á¶œá´¹ Aá´¹) Ïƒ)
        â†’ Subá´¹ Î“á´¹ Î”á´¹ (Ï€â‚ Ïƒ)
      [idSá´¹]
        : {Aá´¹ : Tyá´¹ Î“á´¹ i A}
        â†’ tr Tyá´¹Fam [idS] ([ idSá´¹ ]á´¹ Aá´¹) â‰¡ Aá´¹
      [â¨Ÿá´¹]á´¹
        : {Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ}{Ï„á´¹ : Subá´¹ Î”á´¹ Î˜á´¹ Ï„}{Aá´¹ : Tyá´¹ Î˜á´¹ i A}
        â†’ tr Tyá´¹Fam [â¨Ÿ] ([ Ïƒá´¹ â¨Ÿá´¹ Ï„á´¹ ]á´¹ Aá´¹) â‰¡ [ Ïƒá´¹ ]á´¹ ([ Ï„á´¹ ]á´¹ Aá´¹)
      Ï€â‚‚á´¹
        : (Ïƒá´¹ : Subá´¹ Î”á´¹ (Î“á´¹ ,á¶œá´¹ Aá´¹) Ïƒ)
        ---------------------------------
        â†’ Tmá´¹ Î”á´¹ ([ Ï€â‚á´¹ Ïƒá´¹ ]á´¹ Aá´¹) (Ï€â‚‚ Ïƒ)
      [_]tmá´¹_
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ) {Aá´¹ : Tyá´¹ Î”á´¹ i A}
        â†’ (tá´¹ : Tmá´¹ Î”á´¹ Aá´¹ t)
        â†’ Tmá´¹ Î“á´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹) ([ Ïƒ ]tm t)
    
    _â†‘á´¹_
      : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(Aá´¹ : Tyá´¹ Î”á´¹ i A)
      â†’ Subá´¹ (Î“á´¹ ,á¶œá´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹)) (Î”á´¹ ,á¶œá´¹ Aá´¹) (Ïƒ â†‘ A)
    _â†‘á´¹_ {_} {Î“á´¹} {_} {Î”á´¹} Ïƒá´¹ Aá´¹
      = (Ï€â‚á´¹ idSá´¹ â¨Ÿá´¹ Ïƒá´¹) ,Ë¢á´¹ trTmá´¹â‚œ (sym [â¨Ÿ]) (flip-tr [â¨Ÿá´¹]á´¹) (Ï€â‚‚á´¹ {Î”á´¹ = Î“á´¹ ,á¶œá´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹)} idSá´¹)

    Subá´¹,á¶œá´¹Fam
      : {Î“á´¹ : Ctxá´¹ Î“} â†’ {Ctxá´¹ Î”} â†’ {Sub (Î“ , A) Î”} â†’ Tyá´¹ Î“á´¹ i A â†’ Set â„“â€²
    Subá´¹,á¶œá´¹Fam {_} {_} {_} {_} {Î“á´¹} {Î”á´¹} {Ïƒ} Aá´¹ = Subá´¹ (Î“á´¹ ,á¶œá´¹ Aá´¹) Î”á´¹ Ïƒ

    trTmá´¹â‚› : {A : Ty Î” i}{Î“á´¹ : Ctxá´¹ Î“}{Î”á´¹ : Ctxá´¹ Î”}
            {Ïƒ Ïƒ' : Sub Î“ Î”}(Ïƒâ‰¡Ïƒ' : Ïƒ â‰¡ Ïƒ')
            {Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ}{Ïƒ'á´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ'}
            (Ïƒá´¹â‰¡Ïƒ'á´¹ : tr (Subá´¹ Î“á´¹ Î”á´¹) Ïƒâ‰¡Ïƒ' Ïƒá´¹ â‰¡ Ïƒ'á´¹)
            {Aá´¹ : Tyá´¹ Î”á´¹ i A}{t : Tm Î“ ([ Ïƒ ] A)}
          â†’ Tmá´¹ Î“á´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹) t â†’ Tmá´¹ Î“á´¹ ([ Ïƒ'á´¹ ]á´¹ Aá´¹) (tr TmFamâ‚› Ïƒâ‰¡Ïƒ' t)
    trTmá´¹â‚› refl eq {Aá´¹} = tr Tmá´¹Famâ‚œ (cong ([_]á´¹ Aá´¹) eq)

  record CwFâ‚‚ (Câ‚ : CwFâ‚) : Set (â„“ âŠ” â„“â€²) where
    open CwFâ‚ Câ‚
    field
      _â¨Ÿá´¹idSá´¹
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)
        â†’ tr Subá´¹Fam (Ïƒ â¨ŸidS) (Ïƒá´¹ â¨Ÿá´¹ idSá´¹) â‰¡ Ïƒá´¹
      idSá´¹â¨Ÿá´¹_
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)
        â†’ tr Subá´¹Fam (idSâ¨Ÿ Ïƒ) (idSá´¹ â¨Ÿá´¹ Ïƒá´¹) â‰¡ Ïƒá´¹
      â¨Ÿá´¹-assoc
        : tr Subá´¹Fam â¨Ÿ-assoc (Ïƒá´¹ â¨Ÿá´¹ (Ï„á´¹ â¨Ÿá´¹ Î³á´¹))
        â‰¡ (Ïƒá´¹ â¨Ÿá´¹ Ï„á´¹) â¨Ÿá´¹ Î³á´¹
      Ï€â‚á´¹,Ë¢á´¹
        : tr (Subá´¹ Î“á´¹ Î”á´¹) Ï€â‚, (Ï€â‚á´¹ (Ïƒá´¹ ,Ë¢á´¹ tá´¹)) â‰¡ Ïƒá´¹
      â¨Ÿá´¹,Ë¢á´¹ -- the transport equation seems too long
        : {Î“á´¹ : Ctxá´¹ Î“}{Î”á´¹ : Ctxá´¹ Î”}{Î˜á´¹ : Ctxá´¹ Î˜}
          {Aá´¹ : Tyá´¹ Î˜á´¹ i A}{Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ}
          {Ï„á´¹ : Subá´¹ Î”á´¹ Î˜á´¹ Ï„}{tá´¹ : Tmá´¹ Î”á´¹ ([ Ï„á´¹ ]á´¹ Aá´¹) t}
        â†’ tr Subá´¹Fam â¨Ÿ, (Ïƒá´¹ â¨Ÿá´¹ (Ï„á´¹ ,Ë¢á´¹ tá´¹))
        â‰¡ (Ïƒá´¹ â¨Ÿá´¹ Ï„á´¹) ,Ë¢á´¹ trTmá´¹â‚œ (sym [â¨Ÿ]) (flip-tr [â¨Ÿá´¹]á´¹) ([ Ïƒá´¹ ]tmá´¹ tá´¹)
      Î·âˆ…Ë¢á´¹
        : tr Subá´¹Fam Î·âˆ… Ïƒá´¹ â‰¡ âˆ…Ë¢á´¹
      Î·,Ë¢á´¹
        : tr Subá´¹Fam Î·, Ïƒá´¹ â‰¡ Ï€â‚á´¹ Ïƒá´¹ ,Ë¢á´¹ Ï€â‚‚á´¹ Ïƒá´¹
      [idSá´¹]tmá´¹
        : tr Tmá´¹Fam [idS]tm (trTmá´¹â‚œ [idS] [idSá´¹] ([ idSá´¹ ]tmá´¹ tá´¹))
        â‰¡ tá´¹
      [â¨Ÿá´¹]tmá´¹
        : tr Tmá´¹Fam [â¨Ÿ]tm (trTmá´¹â‚œ [â¨Ÿ] [â¨Ÿá´¹]á´¹ ([ Ïƒá´¹ â¨Ÿá´¹ Ï„á´¹ ]tmá´¹ tá´¹))
        â‰¡ [ Ïƒá´¹ ]tmá´¹ ([ Ï„á´¹ ]tmá´¹ tá´¹)
      Ï€â‚‚á´¹,Ë¢á´¹
        : {Aá´¹ : Tyá´¹ Î”á´¹ i A}{Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ}{tá´¹ : Tmá´¹ Î“á´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹) t}
        â†’ tr Tmá´¹Fam Ï€â‚‚, (trTmá´¹â‚› Ï€â‚, Ï€â‚á´¹,Ë¢á´¹ (Ï€â‚‚á´¹ (Ïƒá´¹ ,Ë¢á´¹ tá´¹)))
        â‰¡ tá´¹
  
  record CwF : Set (â„“ âŠ” â„“â€²) where
    field
      Câ‚ : CwFâ‚
      Câ‚‚ : CwFâ‚‚ Câ‚
    open CwFâ‚ Câ‚ public
    open CwFâ‚‚ Câ‚‚ public
    [Ï€â‚á´¹,Ë¢á´¹]á´¹
      : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(tá´¹ : Tmá´¹ Î“á´¹ ([ Ïƒá´¹ ]á´¹ Bá´¹) t)(Aá´¹ : Tyá´¹ Î”á´¹ i A)
      â†’ tr Tyá´¹Fam (cong ([_] A) Ï€â‚,) ([ Ï€â‚á´¹ (Ïƒá´¹ ,Ë¢á´¹ tá´¹) ]á´¹ Aá´¹) â‰¡ [ Ïƒá´¹ ]á´¹ Aá´¹
    [Ï€â‚á´¹,Ë¢á´¹]á´¹ {Ïƒ = Ïƒ} {A = A} Ïƒá´¹ tá´¹ Aá´¹ = 
        cong (Î» x â†’ tr Tyá´¹Fam (cong ([_] A) Ï€â‚,) ([ x ]á´¹ Aá´¹)) (flip Ï€â‚á´¹,Ë¢á´¹)
      âˆ™ cong (tr Tyá´¹Fam (cong ([_] A) Ï€â‚,)) (sym $ tr-nat Subá´¹Fam (Î» _ x â†’ [ x ]á´¹ Aá´¹) (sym Ï€â‚,))
      âˆ™ cong (tr Tyá´¹Fam (cong ([_] A) Ï€â‚,)) (tr-cong {P = Tyá´¹Fam} (sym Ï€â‚,))
      âˆ™ trÂ² (cong ([_] A) (sym Ï€â‚,))
      âˆ™ cong (Î» p â†’ tr Tyá´¹Fam p ([ Ïƒá´¹ ]á´¹ Aá´¹))
             (uip ((cong ([_] A) (sym Ï€â‚,) âˆ™ cong ([_] A) Ï€â‚,)) refl)
    
    Ï€â‚á´¹â¨Ÿá´¹ 
      : {Aá´¹ : Tyá´¹ Î˜á´¹ i A}(Ï„á´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ï„)(Ïƒá´¹ : Subá´¹ Î”á´¹ (Î˜á´¹ ,á¶œá´¹ Aá´¹) Ïƒ)
      â†’ tr Subá´¹Fam (Ï€â‚â¨Ÿ _ _) (Ï€â‚á´¹ (Ï„á´¹ â¨Ÿá´¹ Ïƒá´¹)) â‰¡ Ï„á´¹ â¨Ÿá´¹ Ï€â‚á´¹ Ïƒá´¹
    Ï€â‚á´¹â¨Ÿá´¹ {Ï„ = Ï„} {Ïƒ} Ï„á´¹ Ïƒá´¹ = 
        cong (tr Subá´¹Fam (Ï€â‚â¨Ÿ Ï„ Ïƒ)) (cong (Î» x â†’ Ï€â‚á´¹ (Ï„á´¹ â¨Ÿá´¹ x)) (flip Î·,Ë¢á´¹))
      âˆ™ cong (tr Subá´¹Fam (Ï€â‚â¨Ÿ Ï„ Ïƒ)) (sym $ tr-nat Subá´¹Fam (Î» _ x â†’ Ï€â‚á´¹ (Ï„á´¹ â¨Ÿá´¹ x)) (sym Î·,))
      âˆ™ cong (tr Subá´¹Fam (Ï€â‚â¨Ÿ Ï„ Ïƒ)) (tr-cong {P = Subá´¹Fam} (sym Î·,))
      âˆ™ trÂ² (cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,)) {Ï€â‚â¨Ÿ Ï„ Ïƒ}
      âˆ™ cong (Î» x â†’ tr Subá´¹Fam (cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ) (Ï€â‚á´¹ x))
             (flip â¨Ÿá´¹,Ë¢á´¹)
      âˆ™ cong (tr Subá´¹Fam (cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ)) 
             (sym $ tr-nat Subá´¹Fam (Î» _ â†’ Ï€â‚á´¹) (sym â¨Ÿ,))
      âˆ™ cong (tr Subá´¹Fam (cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ))
             (tr-cong {P = Subá´¹Fam} (sym â¨Ÿ,))
      âˆ™ trÂ² (cong Ï€â‚ (sym â¨Ÿ,)) {cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ}
      âˆ™ cong (tr Subá´¹Fam (cong Ï€â‚ (sym â¨Ÿ,) âˆ™ cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ))
             (flip Ï€â‚á´¹,Ë¢á´¹)
      âˆ™ trÂ² (sym Ï€â‚,) {cong Ï€â‚ (sym â¨Ÿ,) âˆ™ cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ}
      âˆ™ cong (Î» p â†’ tr Subá´¹Fam p (Ï„á´¹ â¨Ÿá´¹ Ï€â‚á´¹ Ïƒá´¹))
             (uip (sym Ï€â‚, âˆ™ cong Ï€â‚ (sym â¨Ÿ,) âˆ™ cong (Î» x â†’ Ï€â‚ (Ï„ â¨Ÿ x)) (sym Î·,) âˆ™ Ï€â‚â¨Ÿ Ï„ Ïƒ) refl)
    
    [Ï€â‚á´¹â¨Ÿá´¹]á´¹
      : {Bá´¹ : Tyá´¹ Î˜á´¹ i B}(Ï„á´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ï„)(Ïƒá´¹ : Subá´¹ Î”á´¹ (Î˜á´¹ ,á¶œá´¹ Bá´¹) Ïƒ)(Aá´¹ : Tyá´¹ Î˜á´¹ j A)
      â†’ tr Tyá´¹Fam (cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]) ([ Ï€â‚á´¹ (Ï„á´¹ â¨Ÿá´¹ Ïƒá´¹) ]á´¹ Aá´¹)
      â‰¡ [ Ï„á´¹ ]á´¹ ([ Ï€â‚á´¹ Ïƒá´¹ ]á´¹ Aá´¹)
    [Ï€â‚á´¹â¨Ÿá´¹]á´¹ {Ï„ = Ï„} {Ïƒ} {A = A} Ï„á´¹ Ïƒá´¹ Aá´¹ =
        cong (Î» x â†’ tr Tyá´¹Fam (cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]) ([ x ]á´¹ Aá´¹))
             (flip (Ï€â‚á´¹â¨Ÿá´¹ Ï„á´¹ Ïƒá´¹))
      âˆ™ cong (tr Tyá´¹Fam (cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]))
             (sym $ tr-nat Subá´¹Fam (Î» _ x â†’ [ x ]á´¹ Aá´¹) (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ))
      âˆ™ cong (tr Tyá´¹Fam (cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]))
             (tr-cong {P = Tyá´¹Fam} (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ))
      âˆ™ trÂ² (cong ([_] A) (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ)) {cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]}
      âˆ™ cong (tr Tyá´¹Fam (cong ([_] A) (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]))
             (flip [â¨Ÿá´¹]á´¹)
      âˆ™ trÂ² (sym [â¨Ÿ]) {cong ([_] A) (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]}
      âˆ™ cong (Î» p â†’ tr Tyá´¹Fam p ([ Ï„á´¹ ]á´¹ ([ Ï€â‚á´¹ Ïƒá´¹ ]á´¹ Aá´¹)))
             (uip (sym [â¨Ÿ] âˆ™ cong ([_] A) (sym $ Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ cong ([_] A) (Ï€â‚â¨Ÿ Ï„ Ïƒ) âˆ™ [â¨Ÿ]) refl)

  record Univ (C : CwF) : Set (â„“ âŠ” â„“â€²) where
    open CwF C
    field
      Uá´¹
        : (i : â„•)
        â†’ Tyá´¹ Î“á´¹ (suc i) (U i)
      Elá´¹
        : Tmá´¹ Î“á´¹ (Uá´¹ i) t
        â†’ Tyá´¹ Î“á´¹ i (El t)
      Liftá´¹
        : Tyá´¹ Î“á´¹ i A
        â†’ Tyá´¹ Î“á´¹ (suc i) (Lift A)
      cá´¹
        : Tyá´¹ Î“á´¹ i A
        â†’ Tmá´¹ Î“á´¹ (Uá´¹ i) (c A)
      mká´¹
        : Tmá´¹ Î“á´¹ Aá´¹ t
        â†’ Tmá´¹ Î“á´¹ (Liftá´¹ Aá´¹) (mk t)
      uná´¹
        : Tmá´¹ Î“á´¹ (Liftá´¹ Aá´¹) t
        â†’ Tmá´¹ Î“á´¹ Aá´¹ (un t)
      
      []á´¹Uá´¹
        : tr Tyá´¹Fam []U ([ Ïƒá´¹ ]á´¹ (Uá´¹ i)) â‰¡ Uá´¹ i
      []á´¹Elá´¹
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(uá´¹ : Tmá´¹ Î”á´¹ (Uá´¹ i) u)
        â†’ tr Tyá´¹Fam ([]El Ïƒ u) ([ Ïƒá´¹ ]á´¹ (Elá´¹ uá´¹))
        â‰¡ Elá´¹ (trTmá´¹â‚œ []U []á´¹Uá´¹ ([ Ïƒá´¹ ]tmá´¹ uá´¹))
      []á´¹Liftá´¹
        : tr Tyá´¹Fam []Lift ([ Ïƒá´¹ ]á´¹ (Liftá´¹ Aá´¹))
        â‰¡ Liftá´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹)
      []tá´¹cá´¹
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)(Aá´¹ : Tyá´¹ Î”á´¹ i A)
        â†’ tr Tmá´¹Fam ([]tc Ïƒ A) (trTmá´¹â‚œ []U []á´¹Uá´¹ ([ Ïƒá´¹ ]tmá´¹ (cá´¹ Aá´¹)))
        â‰¡ cá´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹)
      []mká´¹
        : (Ïƒ : Sub Î“ Î”) (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)
        â†’ tr Tmá´¹Fam ([]mk _ _) (trTmá´¹â‚œ []Lift []á´¹Liftá´¹ ([ Ïƒá´¹ ]tmá´¹ mká´¹ tá´¹))
        â‰¡ mká´¹ ([ Ïƒá´¹ ]tmá´¹ tá´¹)
      []uná´¹
        : (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ){Aá´¹ : Tyá´¹ Î”á´¹ i A}(tá´¹ : Tmá´¹ Î”á´¹ (Liftá´¹ Aá´¹) t)
        â†’ tr Tmá´¹Fam ([]un Ïƒ A t) ([ Ïƒá´¹ ]tmá´¹ uná´¹ tá´¹)
        â‰¡ uná´¹ (trTmá´¹â‚œ []Lift []á´¹Liftá´¹ ([ Ïƒá´¹ ]tmá´¹ tá´¹))
      Uá´¹Î²
        : tr Tyá´¹Fam UÎ² (Elá´¹ (cá´¹ Aá´¹)) â‰¡ Aá´¹
      Uá´¹Î·
        : tr Tmá´¹Fam UÎ· (cá´¹ (Elá´¹ uá´¹)) â‰¡ uá´¹
      Liftá´¹Î²
        : tr Tmá´¹Fam LiftÎ² (uná´¹ (mká´¹ tá´¹)) â‰¡ tá´¹
      Liftá´¹Î·
        : tr Tmá´¹Fam LiftÎ· (mká´¹ (uná´¹ tá´¹)) â‰¡ tá´¹

  record Î -type (C : CwF) : Set (â„“ âŠ” â„“â€²) where
    open CwF C
    field 
      Î á´¹
        : (Aá´¹ : Tyá´¹ Î“á´¹ i A)(Bá´¹ : Tyá´¹ (Î“á´¹ ,á¶œá´¹ Aá´¹) i B)
        â†’ Tyá´¹ Î“á´¹ i (Î  A B)
      Æ›á´¹_
        : Tmá´¹ (Î“á´¹ ,á¶œá´¹ Aá´¹) Bá´¹ t
        â†’ Tmá´¹ Î“á´¹ (Î á´¹ Aá´¹ Bá´¹) (Æ› t)
      appá´¹
        : Tmá´¹ Î“á´¹ (Î á´¹ Aá´¹ Bá´¹) t
        â†’ Tmá´¹ (Î“á´¹ ,á¶œá´¹ Aá´¹) Bá´¹ (app t)
      []á´¹Î á´¹
        : tr Tyá´¹Fam []Î  ([ Ïƒá´¹ ]á´¹ Î á´¹ Aá´¹ Bá´¹)
        â‰¡ Î á´¹ ([ Ïƒá´¹ ]á´¹ Aá´¹) ([ Ïƒá´¹ â†‘á´¹ Aá´¹ ]á´¹ Bá´¹)
      []Æ›á´¹
        : (Ïƒ : Sub Î“ Î”) (Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ)
        â†’ tr Tmá´¹Fam ([]Æ› Ïƒ _) (trTmá´¹â‚œ []Î  []á´¹Î á´¹ ([ Ïƒá´¹ ]tmá´¹ Æ›á´¹ tá´¹))
        â‰¡ Æ›á´¹ ([ Ïƒá´¹ â†‘á´¹ Aá´¹ ]tmá´¹ tá´¹)
      Î Î²á´¹
        : tr Tmá´¹Fam Î Î² (appá´¹ (Æ›á´¹ tá´¹)) â‰¡ tá´¹
      Î Î·á´¹
        : tr Tmá´¹Fam Î Î· (Æ›á´¹ (appá´¹ tá´¹)) â‰¡ tá´¹

  record Id-type (C : CwF) (U : Univ C) : Set (â„“ âŠ” â„“â€²) where
    open CwF C
    open Univ U
    field
      Idá´¹
        : (aá´¹ : Tmá´¹ Î“á´¹ (Uá´¹ i) a)(tá´¹ : Tmá´¹ Î“á´¹ (Elá´¹ aá´¹) t)(uá´¹ : Tmá´¹ Î“á´¹ (Elá´¹ aá´¹) u)
        â†’ Tyá´¹ Î“á´¹ i (Id a t u)
      []á´¹Idá´¹
        : {Ïƒá´¹ : Subá´¹ Î“á´¹ Î”á´¹ Ïƒ}
          {aá´¹ : Tmá´¹ Î”á´¹ (Uá´¹ i) a}{tá´¹ : Tmá´¹ Î”á´¹ (Elá´¹ aá´¹) t}{uá´¹ : Tmá´¹ Î”á´¹ (Elá´¹ aá´¹) u}
        â†’ tr Tyá´¹Fam []Id ([ Ïƒá´¹ ]á´¹ (Idá´¹ aá´¹ tá´¹ uá´¹))
        â‰¡ Idá´¹ (trTmá´¹â‚œ []U []á´¹Uá´¹ ([ Ïƒá´¹ ]tmá´¹ aá´¹))
              (trTmá´¹â‚œ ([]El Ïƒ a) ([]á´¹Elá´¹ Ïƒá´¹ aá´¹) ([ Ïƒá´¹ ]tmá´¹ tá´¹))
              (trTmá´¹â‚œ ([]El Ïƒ a) ([]á´¹Elá´¹ Ïƒá´¹ aá´¹) ([ Ïƒá´¹ ]tmá´¹ uá´¹))
      reflectá´¹
        : (Pp : Tmá´¹ Î“á´¹ (Idá´¹ aá´¹ tá´¹ uá´¹) p)
        â†’ tr Tmá´¹Fam (reflect p) tá´¹ â‰¡ uá´¹

  record Method : Set (â„“ âŠ” â„“â€²) where
    field
      ğ’    : CwF
      univ : Univ ğ’
      piTy : Î -type ğ’
      idTy : Id-type ğ’ univ

    open CwF ğ’        public
    open Univ univ    public
    open Î -type piTy  public
    open Id-type idTy public
